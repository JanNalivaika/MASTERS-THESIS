% !TeX spellcheck = en_US
\chapter{Methodology}%

\section{Introduction}%

The proposed method aims to provide a framework for optimizing various parameters of an industrial robot toward a specified objective. By effectively utilizing the redundant degrees of freedom mentioned in Chapter \ref{OBJECTIVE}, this method is applicable to robotic milling operations and WAAM processes. The successful implementation of this methodology improves the robot's overall performance and efficiency, leading to increased productivity in industrial operations. The methodology is broken down into two parts. First, an evaluation of process parameters for a specific tool path with set boundary conditions, and second, an optimization of those boundary conditions to optimize the specific process parameters.

\section{General Methodology for Process Analysis and Evaluation}
\subsection{General Methodology}\label{general}

The flowchart in figure \ref{BasicScore} shows the interdependence of a tool path, the used manufacturing machine, the material, and set boundary conditions. The machine defines general parameters like total working volume, DoF, maximum feed rates, and manufacturing process (additive or subtractive). It can be a 6-axis CNC machine or an 8-DoF industrial robot. The part is referred to as the finished geometry as designed in CAD. The material is a user-defined element from which the part should be manufactured. The elements "Machine", "Part" and "Material" directly influence the toolpath that is necessary for manufacturing. The machine, for example, defines if the spindle or the work piece itself needs to be tilted while machining to achieve the desired geometric features. Further elements like available end-mills, desired depth of cut, machining strategy and operation sequence are regarded as adjacent parameters. 


As the tool path is only a relative movement in regards to the work piece, the user is required to define further parameters before starting the manufacturing process. One example is the positioning of the raw stock material in the machine itself and defining the coordinate system that is used as a reference for the tool center point (TCP). These boundary conditions have to be in accordance with the machine's capabilities and can require extensive knowledge about the machine as well as the performed process.
\begin{figure}[H]
	\centerline{\includegraphics[scale=.6]{figures/BasicScore.png}}
	\caption{Interdependence of various parameters}
	\label{BasicScore}
\end{figure}

One of the other parameters that needs to be defined in the "User-Defined Boundary Conditions" is the positioning or constraining of redundant DoF. One of the simplest cases to illustrate this constraining, is when using a 6-DoF robot for milling operations. In milling, the TCP position is defined by three coordinates, namely X, Y, and Z, as well as the rotation around the X and Y axes. The rotation around the Z-axis needs to be defined manually, as the spindle is rotationally symmetric around that axis. This constraint ensures that the robot maintains a specified pose while performing milling operations. The rotation around the Z axis can, in theory, be set to any arbitrary value but can influence the overall process parameters significantly. In practical applications, this rotation value is limited due to factors like cable routing or joint limits. The same limitations come into play in WAAM where the wire feed system cobmined with the torch position limit the possible orientation.

After the constraints are set and the tool path is generated, various process parameters can be analyzed. Some of the more prominent parameters are the total angular travel of a specific joint or the total angular acceleration. In addition to these numerical values, the user can define a specific importance for the analyzed process parameters and, with a weighting of all available process parameters, calculate an overall score of the determined tool path.

In the following, the elements "Adjacent parameters" and "Material" are omitted as they do not directly impact the optimization of a manufacturing process, as explained in Chapter \ref{OBJECTIVE}. They are hard constraints that define the possible tool path and are not directly related to the redundant DoF. Nonetheless, it is important to note that these adjacent parameters can still offer a significant improvement in areas like cycle time or surface finish of the manufactured part.

%More information regarding the parameters and weights is presented in chapter \ref{pp}.
\newpage
\subsection{Process Parameters}\label{pp}


Table \ref{procesparameters} presents a comprehensive overview of the various process parameters that can be derived from a tool path with defined boundary conditions that is executed by an industrial robot. 


\begin{table}[H]
	\centering
	\begin{tabular}{||l|r||}
		\hline
		Process Parameter & Numerical Form\\
		\hline
		\hline
		\hline
		Angular position of each joint & Time-series\\
		Angular velocity of each joint & Time-series\\
		Angular acceleration of each joint& Time-series\\
		Angular jerk of each joint& Time-series\\
		\hline
		\hline
		Direction changes of each joint& Scalar value\\
		Total travel of each joint& Scalar value\\
		\hline
		\hline	
		
		TCP coordinates (X,Y,Z) & Time-series\\
		TCP velocity (X,Y,Z) & Time-series\\
		TCP acceleration (X,Y,Z) & Time-series\\
		
		
		\hline
		\hline
		Continuous energy usage & Time-series\\
		Total energy usage & Scalar value\\
		\hline
		\hline
		Reachability index & Binary value / Time-series\\
		Singularity Analysis & Scalar value / Time-series\\
		Torch orientation & Time-series\\
		
		
		\hline
		\hline
		
	\end{tabular}
	
	
	\caption{Process parameter and their numerical form}
	\label{procesparameters}
\end{table}

One of the first key parameters is the joint position, which is typically recorded as a one-dimensional array containing the rotational position or extension values of each rotary or linear joint at every time step. This information serves as a basis for determining subsequent parameters such as velocity, acceleration, and jerk. These parameters are important to analyze so that it can be ensured that the joints are not overly strained in the manufacturing process and their service life can be extended as much as possible.
 
In order to prolong the lifespan of an industrial robot, it is crucial to consider the load on individual joints. One important indicator of joint load is the number of direction changes that a joint undergoes during its operation. High-frequency rotation changes can result in significant degradation and loss of precision during manufacturing processes.
This process parameter, known as the number of direction changes, is a scalar value that can be derived from the angular position of each joint. By further analyzing the joint position data, the total travel of a joint can be determined by taking the integral of the joint velocity over time.

Additionally, it can be analyzed whether a velocity change always occurs at the same position and thus introduces wear at the same tooth flank. This results in significant local wear and shortens the lifespan of the joints. 
\newpage
Programs or tool paths that require less total joint travel are generally more desirable. By minimizing the number of direction changes and optimizing the joint travel, the stress and wear on the robot joints can be reduced, thereby extending the overall lifespan of the robot system.

By employing a forward kinematics approach or extracting it directly from the G-code, it becomes possible to determine the position (X Y Z position) and orientation (rotation) of the TCP (Tool Center Point). Additionally, the acceleration and jerk of the TCP can be calculated by taking the respective derivatives with respect to time. These derived parameters, along with the joint positions, are all stored in the form of arrays that capture the temporal changes in their respective values. These parameters can be used to determine how many times a robot will deviate from the proposed tool path and how much deviation in the continuous path mode can be expected.



Estimating the energy usage in industrial robot applications is another crucial aspect that is becoming more important in the current manufacturing environment. One option to accurately estimate energy consumption is to perform a multi-body simulation. For that, it is essential to have a correct 3D model that includes information about the weight and its distribution of the robot joints. Another option is to employ machine learning (ML) approaches or any other intermediate analysis.

Furthermore, in cases where the industrial robot is utilized for WAAM, the power required for welding can be extracted from the G-code by analyzing the duration for which the welding torch remains active. The continuous energy similarly to the other parameters mentioned earlier, is also represented in the form of an array to capture the variations over time.

Total energy usage, measured in kWh, is a key parameter that can be measured directly during the manufacturing process. It provides valuable insights into the overall energy consumption of the industrial robot system. This parameter can be obtained by monitoring the energy usage in real-time or by integrating the time-series data of the continuous energy consumption. By analyzing energy usage, manufacturers can identify energy-intensive processes or operations, optimize energy consumption, and implement strategies to reduce overall energy consumption, leading to cost savings and environmental benefits.

%Alternatively, if direct measurement of energy usage is not available, the energy consumption can be estimated by integrating the time-series data of the energy consumption. This involves summing up the energy consumed at each time-step over the duration of the manufacturing process. Although this estimation method may not be as accurate as direct measurement, it can still provide valuable insights into the overall energy usage.


The reachability index is a binary parameter used to determine the feasibility of executing a program in an industrial robot system. This index indicates whether all the necessary points defined in the tool path are inside the working volume of the robot and can be reached by the robot's TCP. This parameter helps ensure that the robot can physically access all the required positions in the work area. If any point is found to be outside the reachable workspace, it indicates a need for adjustments. Additional factors like cable routing can also influence reachability, even though the endpoints lie inside the working volume of the robot. Wire-feed systems or optical fiber used to transmit a laser can only tolerate a set bending degree. When specifically analyzing the orientation regarding the cable routing, the reachability index can take the form of a time-series that records the deviation of the bending angle of a cable from the optimal angle.


The singularity analysis parameter can be represented either as a time-series or as a single numerical value. It is based on the smallest eigenvalue of the Jacobian matrix, which is calculated using the robot's current configuration. This parameter can be stored in array form, capturing the changes in singularity analysis over time. Alternatively, only the smallest eigenvalue encountered during the entire tool path can be recorded. The analysis of the singularity time-series can be used to optimize non-optimal poses, ensuring that the robot avoids singular configurations that may lead to reduced performance or unexpected behavior.

%Torch orientation is a parameter specific for WAAM. It tracks the tilt angle of the welding torch. For optimal performance is it necessary that the material depositions happens in direction of gravity. In the worst case scenario the welding head is positioned upside down and the welding process is happening against the direction od gravity. The time-series records the deviation of the torch angle from the gravity vector.



Torch orientation is a critical parameter in WAAM. It monitors the tilt angle of the welding torch during the process. To achieve optimal performance, it is essential that the material deposition process always occurs in the direction of gravity. When the welding head is positioned upside down, it represents a worst-case scenario where the welding process takes place against the force of gravity.
When the tilt angle significantly deviates from the gravity vector, maintaining the stability of the molten metal pool becomes more difficult, potentially leading to defects like sagging. 

To ensure the torch orientation is properly monitored, a time-series is used to record the deviation of the torch angle from the gravity vector. Analyzing this information helps identify any deviations or issues that may affect the quality of the deposited material. 


%To ensure safe and efficient operations, both the reachability index and the collision index are evaluated before the G-code program is executed. If all positions in the tool path are reachable and no collision is expected, the G-code is considered safe for production and can be executed. If any issues are identified, adjustments can be made to the program or the robot's configuration to ensure proper reachability and collision avoidance.




Figure \ref{ParamsFlow} visualizes how the different parameters are interconnected. It is clearly visible that all parameters can be derived from the angular position of the joints. This is a clear indicator of the importance of that information. The angular position data provides essential information for analyzing and optimizing the performance of the robot system. By monitoring and analyzing the joint positions, the user can gain insights into various aspects of the robot's operation and make informed decisions to optimize productivity.




\begin{figure}[H]
	\centerline{\includegraphics[width=0.781\textwidth]{figures/Flow.png}}
	\caption{Parameter Flowchart}
	\label{ParamsFlow}
\end{figure}

\newpage

\section{User-Defined Weights and Score Calculation}\label{weights}
\subsection{Local Rating and Global Score}
To assess if a tool path with its boundary conditions is optimal or offers the possibility for improvement, a score or rating value is required that takes the process parameters and their importance into account. 

Determining the relative importance of different parameters can involve subjective judgments, expert knowledge, and consideration of specific manufacturing constraints. For example, in some cases, minimizing joint jerk may be the primary objective, while in others, energy usage may take precedence.

To quantify the performance of a tool path, the user can assign weights or importance factors to each parameter based on their specific requirements. These weights can reflect the relative significance of each parameter in achieving the desired optimum. A weighted sum or scoring method can then be used to evaluate and compare the same tool paths with different constraints based on the aggregated scores of the individual parameters. %The sum of all defined importance values must add up to 1 so that the most optimal tool path has the global score of 100.

It's important to note that the subjective weighing of parameters can vary between different manufacturing scenarios and requires continuous evaluation and adjustment based on changing priorities or goals.

The score of a tool path with its boundary conditions is calculated as shown in table \ref{weighting}. Each process parameter can take a local rating in the range 0-100. 0 being the least optimal, while 100 represents the optimal best-case solution. This value is multiplied by the importance factor and returns the local score. 
All local scores are summed up and result in the overall global score of that specific tool path with corresponding boundary conditions and that specific importance assignment.
The sum of all defined importance values must add up to 1 so that the most optimal boundary conditions lead to a global score of 100.


\begin{table}[H]
	\centering
	\begin{tabular}{||l|r|r|r||}
		Process Parameters & Local rating & Importance & Local score\\
		\hline
		\hline
		\hline
		
		Process Parameter 1 & 74 & 0.5 & 37\\
		Process Parameter 2 & 34& 0.1&3.4\\
		Process Parameter 3& 65& 0.1&6.5\\
		Process Parameter 4& 22&0.3&6.6\\
		\hline
		\hline
		\hline
		Global Score& & &53,5\\
		\hline
		\hline
	\end{tabular}
	
	\caption{Calculation of a tool path score}
	\label{weighting}
\end{table}


\subsection{Local Rating Calculation}\label{LRC}
Calculating a local rating is not a straight-forward approach. The first problem is that based on a singular value like "direction changes," it is not possible to determine a local rating as it is not clear if that value is close to optimal or far from it.
The solution to this problem is to calculate the tool path with different boundary conditions or constraints, like rotation around the C-axis, and compare the different results.
Figure \ref{Localscore} shows how a local score can be calculated by means of variation. Each variation leads to a different number of direction changes in joint 1. The local score is calculated by essentially applying a Min-Max scaler.

\begin{figure}[H]
	\centerline{\includegraphics[width=0.8\textwidth]{figures/localscore.png}}
	\caption{Calculation of the local score trough variation}
	\label{Localscore}
\end{figure}

It is important to note that performing more variations before calculating the local sore will increase the accuracy of this approach. If only a few variations are performed, it is possible that only variations with similar outcomes will be found, which can skew the result significantly.

Another factor that needs to be analyzed is whether the variations in the boundary result in local scores that exceed a certain standard deviation. Figure \ref{lowstd}, shows how a local score of 66 is calculated despite the presence of very small absolute differences. In this case, the standard deviation is only 0.37. Figure \ref{highstd} demonstrates how the same local score of 66 is calculated even though the absolute differences are significantly higher. Here, the standard deviation is 22.36. Only if the standard deviation exceeds a set threshold should the local score be used as input for the global score. In cases where the standard deviation criteria is not met, the corresponding process parameter should be omitted from the global score calculation.

\begin{figure}[H]
	\centerline{\includegraphics[width=0.8\textwidth]{figures/lowstd.png}}
	\caption{Variation with low standard deviation}
	\label{lowstd}
\end{figure}

\begin{figure}[H]
	\centerline{\includegraphics[width=0.8\textwidth]{figures/highstd.png}}
	\caption{Variation with high standard deviation}
	\label{highstd}
\end{figure}

 
\subsection{Information Extraction form Time-Series Data}\label{extraction}
It is important to note that for a local score computation, as mentioned in Chapter \ref{LRC}, a time-series needs to be transformed into a scalar value. This can either be done by directly transforming the time-series like, for example, summing up all values or performing a subsequent analysis. As each time-series is capturing different physical phenomena, each one requires an individual process for transforming into a scalar value.
\newpage




\section{Information from Angular Position}
In its isolated form, the angular position of a joint does not provide information to enable extensive qualitative analysis. However, when supplemented with temporal information, it becomes a valuable source of information. By considering the angular position in conjunction with the temporal dimension, a more comprehensive understanding of joint behavior can be obtained, allowing for more in depth analysis.



Figure \ref{agularstuff} visualizes what information needs to be added to enrich the analysis of these process parameters that are directly related to the angular position of joints.

\begin{figure}[H]
	\centerline{\includegraphics[width=0.8\textwidth]{figures/angularstuff.png}}
	\caption{Additional Information for angular position of each joint}
	\label{agularstuff}
\end{figure}



The first additional piece of required information is the temporal element, which specifies the specific time at which a joint should be in a particular rotational position. This information can be recorded in equidistant time steps, as shown in figure \ref{equi} on the left, or it can be adapted to only record the change in position, as shown on the right. However, recording only the change in position is not ideal because it does not accurately represent the physical system, where the position cannot change significantly from one time step to the next. Moreover, this method does not specify the rotational velocity at which the joint should change position. On the other hand, continuous recording in small equidistant time steps can result in a larger number of recorded values and, consequently, a longer time-series.

Figure \ref{equi} illustrates the rotational position of a rotary joint in radians. The left side of the figure displays the position recorded with equidistant time steps, while the right side shows a time-series where only the destination positions and their corresponding times are recorded.


\begin{figure}[H]
	\centerline{\includegraphics[width=1\textwidth]{figures/equionchange.png}}
	%\caption{Time-series of a rotary joint with equidistant time steps}
	\caption{Two option for recording the joint position in a time-series}
	\label{equi}
\end{figure}

%\begin{figure}[H]
%	\centerline{\includegraphics[width=0.5\textwidth]{figures/onchange.png}}
%	\caption{Time-series of a rotary joint with only the recorded end positions}
%	\label{onchange}
%\end{figure}

\subsection{Total Joint Travel and Direction Changes}
Parameters that can be analyzed without requiring any additional information include the number of direction changes and the total travel of a joint. The total travel can be determined by subtracting the position of two adjacent recorded points and summing up the absolute values. Furthermore, additional information can be extracted by separately summing up the clockwise and anti-clockwise rotations. By combining the absolute values of these rotations, the total travel of the joint can be calculated.

igure \ref{travel} provides a visual representation of the calculation of total travel. The total forward rotation can be obtained by summing up the lengths of the green arrows, while the total backward rotation is determined by summing up the lengths of the orange arrows.

\begin{figure}[H]
	\centerline{\includegraphics[width=0.5\textwidth]{figures/travel.png}}
	\caption{Summing up the rotation in the clockwise and anti-clockwise direction }
	\label{travel}
\end{figure}

The number of direction changes is a parameter that can be determined by analyzing the joint position alone, without the need for temporal information. This can be done by identifying all points where the position before and after is either smaller or larger. However, it is important to note that this method may not be applicable to points where multiple positions are recorded at the same value right after each other.

To address the issue of multiple positions recorded at the same value, a possible solution is to introduce a tracking value that indicates whether the previous change in direction of two adjacent positions was either up or down. If the direction of two positions is different from the tracking value, the direction change counter is incremented by 1. However, if the direction is the same as the previous points or if the positions are identical (neutral), the direction change counter and tracking values remain unchanged.

Figure \ref{dirchange} gives a visual representation of where the direction-change-counter is incremented.

\begin{figure}[H]
	\centerline{\includegraphics[width=0.8\textwidth]{figures/dirchange.png}}
	\caption{Calculating direction changes from a time-series}
	\label{dirchange}
\end{figure}

The counters for direction changes and total travel of each joint can be transformed into a local score, as explained in Chapter \ref{LRC}. This local score can then be multiplied by an importance factor to calculate the overall local score. The direction changes can be summed up over all joints, or they can be specifically grouped based on certain criteria or categories.  

Table \ref{exampleDirTravel} gives an example of how a global score can be calculated based only on the number of direction changes and total travel. This table demonstrates how different joints and parameters can be weighted and grouped together to calculate the global score. By assigning different importance factors to each parameter, the overall global score can reflect the desired outcome. It is important to note that only the local scores are multiplied by the importance factor, not the actual counted direction changes or total travel values. This allows the local score to fall within the range of 0 to 100. In this example, due to the high local score and importance factor for the direction changes in joint 1, the overall global score is also very high, indicating its significance in the calculation.


\begin{table}[H]
	\centering
	\begin{tabular}{||l|r|r|r||}
		Process Parameters & Local rating & Importance & Local score\\
		\hline
		\hline
		\hline
		
		Direction changes in joint 1 & 95 & 0.7 & 66.5\\
		Direction changes in joint 2-6 & 45& 0.1&4.5\\
		Total travel in joint 4& 34& 0.1&3.4\\
		Total travel in joint 1-3 and 5-6& 46&0.1&4.6\\
		\hline
		\hline
		\hline
		Global Score& & &79\\
		\hline
		\hline
	\end{tabular}
	
	\caption{Calculation of a score regarding only direction changes and total travel}
	\label{exampleDirTravel}
\end{table}

In certain cases, it may not be possible to reduce the number of direction changes by adjusting the boundary conditions. It is important to note that having the same number of direction changes does not imply that two time-series are identical. Figure \ref{dirchangeSTD} provides a visual representation of two time-series with the same number of direction changes but distinct characteristics.

To distinguish between these cases, the standard deviation can be utilized. By incorporating the standard deviation, tool paths that result in frequent and closely spaced direction changes can be identified and generally considered less desirable.

To combine the factor of standard deviation with the number of direction changes, they can be integrated into a single parameter. This is achieved by dividing the number of direction changes by the standard deviation. By incorporating this variation-based calculation, a local score can be determined.

When there are only a few direction changes but with a high variance, the resulting parameter value will be low. Conversely, when there are numerous direction changes but with a low variance, the parameter value will be high.

This approach provides a evaluation method that considers both the quantity of direction changes and the variability within the time-series data.

\begin{figure}[H]
	\centerline{\includegraphics[width=0.7\textwidth]{figures/DirSTD.png}}
	\caption{Two Time-Series with equal number of direction changes but different characteristics}
	\label{dirchangeSTD}
\end{figure}

\subsection{Rotation Limits}\label{RotLim}
In addition, a straightforward analysis of the rotational limits can be conducted, requiring knowledge of two distinct values. The first value are the physical limit that a joint cannot surpass, as surpassing this limit can cause significant damage to the robot. The second value relates to potential soft limits in place to prevent over-rotation of the joint beyond its physical limits. To validate whether any rotational positions approach or exceed these limits, a simple comparison of all values can be performed. In cases where it is known that a joint is most stable within a specific range, additional limits can be defined accordingly.

Once a tool path with defined boundary conditions is established, the joint angles can be analyzed through a simple comparison process. If the joint positions surpass the soft limits or deviate excessively from the desired orientation, a "No-Go" exception is triggered. It's worth noting that the analysis of rotation limits does not contribute to the calculation of the global score but serves as a validity assessment to determine if the required movement for the tool path is physically feasible.
\newpage
\subsection{Velocity, Acceleration and Jerk of the Joints}\label{VAJJ}
To conduct a specific analysis of the rotational velocity, acceleration, and jerk of the joints, a time derivative needs to be applied. By performing simple comparisons of the time-series values, it becomes possible to determine whether the maximum capabilities of the motor driving the joint are being exceeded.

Figure \ref{velo} demonstrates how the velocity aspect can be transformed into a scalar value, which can then be utilized in the calculation of a local score. Firstly, the joint velocity is obtained by taking the time derivative of the joint position. Subsequently, an analysis is conducted to determine the duration for which the absolute velocity exceeds a certain threshold value. In the given example, the threshold is set at 80\%. Additionally, it is feasible to incorporate multiple thresholds and assign exponential weights to them relative to each other. The combined outcome is then utilized to calculate the local score.

\begin{figure}[H]
	\centerline{\includegraphics[width=1\textwidth]{figures/veloy.png}}
	\caption{Calculating velocity from the joint position over time}
	\label{velo}
\end{figure}

It is also possible to define if a short but significant peak over the threshold values is more desirable than a constant but small overstep. Figure \ref{peaklong} gives a visualization of these two cases. In the former case, where peaks are more desirable, it is enough to sum up The area between the velocity and set threshold. If the avoidance peaks is the first priority, all elements in the velocity time series can be cubed and summed up. By cubing the values, peaks will be weight exponentially and thus easier to optimize for.

\begin{figure}[H]
	\centerline{\includegraphics[width=1\textwidth]{figures/peaklong.png}}
	\caption{Overstepping the threshold value}
	\label{peaklong}
\end{figure}


The simplest case, however, is to square all values and sum them. By employing this method, there is no need to define threshold boundaries. Additionally, high peaks will have a greater influence on the resulting value compared to small constant values, without overshadowing the final result.

If the velocity exceeds the maximum velocity, an exception called "No-Go" must be thrown, indicating that the movement is not possible. The same rating principle can be applied to acceleration and jerk. The acceleration is obtained by taking the derivative of the velocity, while the jerk is obtained by taking the next derivative. Individual limits and thresholds can be set to determine the optimality of the robot's movement. If the maximum acceleration or jerk is exceeded, a "No-Go" error is also thrown.


Table \ref{VAJ} presents the calculation of a global score, which incorporates a weighting that prioritizes low acceleration in joint 2 and allows for high velocity in all joints. The acceleration in joint 1 and joints 3 to 6 are considered to be of lesser significance. The jerk is completely omitted from the rating in this example.


\begin{table}[H]
	\centering
	\begin{tabular}{||l|r|r|r||}
		Process Parameters & Local rating & Importance & Local score\\
		\hline
		\hline
		\hline
		Velocity in Joints 1-6& 45& 0.1&4.5\\
		Accelerations in Joint 2& 90 & 0.8 & 72\\
		Accelerations in Joint 1 and 3-6 & 15& 0.1&1.5\\
		Jerk in joints 1-6& 4& 0&0\\
		
		\hline
		\hline
		\hline
		Global Score& & &78\\
		\hline
		\hline
	\end{tabular}
	
	\caption{Calculation of a score regarding only velocity, acceleration and jerk}
	\label{VAJ}
\end{table}


\section{TCP Coordinates, Velocity and Acceleration}\label{CVA}
As discussed in Chapter \ref{pp}, the forward kinematics approach allows for the calculation of the TCP's X-Y-Z coordinates and orientation. Alternatively, this information can be directly extracted from the G-code.

By calculating the time derivative of the positions, it is possible to determine both the velocity and acceleration of the TCP. These parameters play a significant role in milling applications, particularly when precise corners need to be fabricated. It is important to note that both robotic systems and CNC machines have limitations on their acceleration capabilities. As highlighted in Chapter \ref{CPM}, these limitations result in slight deviations occurring in the path, especially at corners. These deviations arise from the systems' inability to instantaneously change velocity or direction. Consequently, the TCP's path will not be perfectly followed as demanded by the G-Code and will exhibit minor variations in the corners.

To quantitatively analyze the magnitude and frequency of these deviations, it is crucial to examine the endpoints of the linear toolpath as defined in the G-code. When the endpoints are aligned along a vector in space, it indicates that no deviation from the desired toolpath is expected. However, a misalignment between the endpoints suggests an anticipated deviation.

Figure \ref{devi} gives a visual example of the position in th X-Y plane that the robot needs to traverse. The expected deviation is shown in red.

\begin{figure}[H]
	\centerline{\includegraphics[width=.651\textwidth]{figures/uber.png}}
	\caption{Deviation of of the TCP from the actual toolpath}
	\label{devi}
\end{figure}

In order to obtain a qualitative estimate of the total deviation, it is necessary to analyze the individual velocity vectors that characterize the toolpath. Perfect alignment of the velocity vectors indicates no expected deviation. However, as the angle between consecutive velocity vectors increases, the deviation also increases.

To quantitatively represent this information, the sine of each angle can be calculated and summed. An angle of 0 or 180 degrees will result in a value of 0, while an angle of 90 degrees will yield a value of 1. This scalar value provides an indication of the overall magnitude of the expected deviation.

Additionally, it is crucial to consider the magnitude or speed of the velocity vectors. In cases involving sharp corners with high velocities, the deviation is anticipated to be more significant compared to corners with lower velocities. To account for this, the result obtained from the sine calculation can be multiplied by the smaller of the two velocities.

This analysis is useful for operators in defining more optimal machining strategies. However, it is important to note that this analysis is separate from the optimization involving the redundant DoF.

In the context of WAAM, the acceleration of the welding torch plays a crucial role in the process. This is particularly evident when utilizing CMT technology, which involves wire retraction, as discussed in Chapter \ref{CMT}. A rapid acceleration of the welding torch can lead to unintended drop detachment and imprecise drop placement. Consequently, the quality and accuracy of the additive manufacturing process may be compromised, resulting in defects and deviations from the desired geometry.

However, it is worth noting that, similar to the deviation in the toolpath discussed earlier, this issue cannot be directly optimized by simply defining specific boundary conditions.

\section{Energy Usage}
Energy usage is a crucial aspect of modern manufacturing. To minimize unnecessary and energy-intensive movements, it is essential to select appropriate boundary conditions for robots. The analysis of energy usage can be approached in two distinct ways. Firstly, a continuous energy analysis allows to attribute specific energy consumption to each movement. Secondly, it is possible to consider the overall energy requirement throughout the entire manufacturing process, providing a holistic perspective on energy utilization. These approaches can optimize energy usage and make informed decisions regarding energy efficiency in manufacturing. 

\subsection{Continuous Energy-Usage}
Tracking energy consumption can be achieved through a straightforward method of monitoring the velocity and acceleration of individual joints. The energy demand is composed of two components: the rotational movement of a joint at a predetermined speed and the joint's acceleration.

To determine the energy consumed by each joint, the time-series data of joint velocity can be multiplied by the average energy consumption value associated with that particular joint. The same principle is applied to the time-series data of joint acceleration. By summing up these resultant time-series, an energy consumption profile for each joint can be obtained. Aggregating the time-series data from all joints provides an overall estimation of the robot's energy consumption. Table \ref{scalers} gives exemplary values for the scaling factors.\newline


\begin{table}[H]
	\centering
	\begin{tabular}{||l|r|r||}
		Joint Nr.  & Velocity Scaling in \(\frac{\si[per-mode=symbol]{\kWh}}{\si[per-mode=symbol]{\m\per\sec }}\)& Acceleration Scaling in \(\frac{\si[per-mode=symbol]{\kWh}}{\si[per-mode=symbol]{\m\per\sec\squared }}\) \\
		\hline
		\hline
		\hline
		Joint 1	& 0.1 & 0.5\\
		Joint 2	&  0.4& 0.3 \\
		Joint 3	& 0.3& 0.2\\
		...& ...& ...\\
		
		\hline
		\hline
	\end{tabular}
	
	\caption{Average scaling factors for energy calculations}
	\label{scalers}
\end{table}


This approach offers a notable advantage in its simplicity. Nevertheless, its primary limitation stems from the potential inaccuracies that may arise when working with an average scaling value. If this value is derived by averaging all possible positions, but only a limited number of positions are actually traversed by the robot, significant discrepancies can occur.


To address these limitations, more advanced approaches are necessary. For instance, the utilization of multi-body simulations in CAM software enables a direct analysis of the exact energy requirements for a robot to move between different poses. This method involves precise modeling of weight distribution, resulting in highly accurate outcomes. However, it is important to consider that implementing this approach may require substantial computation and development time.


Another viable option to consider is the utilization of a machine learning (ML) approach for estimating energy consumption during transitions between discrete poses. By employing a supervised learning technique, where the input data includes the current pose (joint positions and velocities) as well as the target pose, an ML model can be trained to predict the energy required for each transition. This approach offers the advantage of leveraging ML algorithms to provide accurate energy consumption estimates in a more efficient manner. However, it is important to acknowledge that generating high-quality training data and training the ML model can be time-intensive processes.

Figure \ref{ENERGYOPTIONS} illustrates the three aforementioned options along with their key requirements. It is important to note that these examples only give an example on how to get a energy estimation and do not cover all possible solutions to address this problem. 

\begin{figure}[H]
	\centerline{\includegraphics[width=.8\textwidth]{figures/ENERGYOPTIONS.png}}
	\caption{Exemplary methods for energy usage calculations}
	\label{ENERGYOPTIONS}
\end{figure}

Once the time-series data for energy consumption is obtained, it becomes possible to identify peaks and associate them with specific movements. In line with the optimization objective, it is also feasible to establish threshold values, as discussed in Chapter \ref{CVA}, to optimize for a consistent energy consumption.


\subsection{Total Energy-Usage}
When the aim is to obtain a single scalar value for energy consumption, the same procedures outlined in the preceding chapter can be applied, and the values from the time series can be aggregated through summation.

In situations where the temporal information in energy consumption is considered irrelevant, alternative machine learning approaches can be employed. For example, Recurrent Neural Networks (RNNs) can be utilized, as they have the ability to take an entire time series as input and generate a scalar value representing the total energy consumption. RNNs excel at capturing dependencies and patterns in sequential data. By training an RNN model using a time series dataset, it can learn to predict the total energy consumption based on the provided input. However, it is important to note that, like most machine learning approaches, this method requires substantial effort and time for generating training data and conducting the training process.

In WAAM, it is important to consider the energy consumption associated with the welding process itself. The determination of energy use in welding involves various factors. The G-code, which comprises instructions for the welding process, can provide information on the movement, voltage and the desired power input. By analyzing this code, it becomes possible to estimate the energy consumption during each welding operation. Alternatively, these parameters are often pre-defined as constants on the welding appliance, with the G-code solely specifying the turn-on and turn-off points.

In addition to the factors mentioned earlier, the duration of the welding process and the parameters of the welding equipment play crucial roles in determining energy consumption. By considering these factors, it is possible to accurately assess the energy usage during welding operations.

However, this specific part of the total energy consumption cannot be optimized by defining the boundary conditions of redundant DoFs. The energy required for the welding process is solely defined by the welding parameters and G-code.


\section{Reach, Singularities and Torch Orientation}
The following discusses the robot poses with respect to reach, singularity avoidance, and torch orientation. These factors are essential in ensuring successful and efficient robotic operations.
\subsection{Reach and Orientation}\label{RO}

As mentioned in Chapter \ref{pp}, the analysis of the reachability index can be conducted in various formats. The first format involves a simple analysis to determine if all the points that the robot needs to traverse lie within its work volume, without any self-collisions or exceeding the hard joint limits. This aspect is closely related to the joint limits, as discussed in Chapter \ref{RotLim}. Additionally, it is necessary to analyze that there are no collisions between the robot and the workpiece. If all these parameters are met, a binary index can be used to indicate the feasibility and safety of executing the program. However, this index cannot be used for optimizing the robot's movement, as the parameters influencing this index are mostly defined by the G-Code.

When utilizing a robotic system with a specific tool, such as a milling spindle or a welding torch for WAAM, it is crucial to consider the boundary conditions associated with that tool. In many cases, the spindle and welding torch come with cables that provide power from an external power supply. These cables have an optimal orientation where bending and wear are minimized. By positioning the cables in an optimal orientation, the robotic system can operate efficiently and effectively without any interference or limitations due to cable movement, potential damage, or excessive bending or twisting.

Figure \ref{rot} illustrates the rotation around the C-axis of the welding torch, which leads to different strains on the wire with each rotation.

\begin{figure}[H]%
	\centering
	\subfloat[\centering No rotation]{{\includegraphics[width=.4\textwidth]{figures/rot0.png} }}%
	\qquad
	\subfloat[\centering 30 degree rotation]{{ \includegraphics[width=.4\textwidth]{figures/rot1.png}}}%
	\caption{Rotation around the C-axis of a welding torch }%
	\label{rot}%
\end{figure}
 
To assess the efficiency of the robot's cable pose, it is important to consider additional parameters. In certain cases, it is preferable to route the cables in a specific orientation along a spatial vector, allowing for parallel translation or movement in the direction of that vector. In this case, the angle between the planes of the robot's base coordinate system remains constant.

Figure \ref{OOPti}a provides a visual representation of this example. The wire, shown in red, has an optimal orientation where the least amount of strain is present. Any position along that vector where the cable transitions to the welding torch tangentially is considered optimal. It is worth noting that this vector can be translated parallel in space while still maintaining its optimal status.

In certain scenarios, it is more efficient to route the cables towards a specific point in space, such as a mounting point on a wall. Figure \ref{OOPti}b illustrates an example where the optimal orientation of a milling spindle is directed towards a designated point where the cables originate. In this case, any position is considered optimal as long as the extended spindle vector aligns with the vanishing point.


\begin{figure}[H]%
	\centering
	\subfloat[\centering Optimal orientation along a vector ]{{\includegraphics[width=.5\textwidth]{figures/paralell.png} }}%
	\qquad
	\subfloat[\centering Optimal orientation towards a defined points ]{{ \includegraphics[width=.35\textwidth]{figures/angle.png}}}%
	\caption{Two examples for optimal orientation along a vector in 2D}%
	\label{OOPti}%
\end{figure}



To minimize the deviation from the optimal vector or vanishing point, the redundant degrees of freedom can be utilized. One approach is to analyze the deviation and track it over time, creating a time series. Each element in this time series can be squared or cubed, depending on the weight assigned to small and constant deviations versus large but short offsets. The time series is then summed up to form a scalar value, which can be used to calculate the local score through the variation method.


Figure \ref{deviation} illustrates an example of how the scalar value is calculated. It is evident that when cubing the time series, more importance is placed on the larger deviations rather than small deviations.


\begin{figure}[H]
	\centerline{\includegraphics[width=.9\textwidth]{figures/devi.png}}
	\caption{From time-series of the deviation vector to scalar value}
	\label{deviation}
\end{figure}
 

\subsection{Singularities}

In Chapter \ref{Singularity avoidance}, the concept of singularities in robotic manipulators is discussed. Singularities occur when the robot's joints align in a way that limits its motion by reducing one or more degrees of freedom. To avoid singularities, it is important to optimize the boundary conditions in the redundant degrees of freedom. The singularity analysis, as described in Table \ref{procesparameters}, can be represented either as a scalar value or as a time series that classifies each position based on its proximity to a singularity.

The scalar value can represent the overall smallest eigenvalue of every Jacobi matrix. For this, every pose needs to be analyzed. After calculating the Jacobi matrix, all eigenvalues encountered are examined, and only the smallest one is recorded and used to calculate the local score. This approach allows for an analysis of the overall toolpath rather than specific poses.

Alternatively, a time series can be used where the determinant, not the eigenvalues, is recorded and stored. By analyzing this time series, it becomes possible to directly associate the robot's movements with its proximity to a singularity. This enables a more precise understanding of where the robot's motions are close to a singularity, allowing for subsequent optimizations. To transform the time series into a scalar value, the same threshold method described in Chapter \ref{VAJJ} can be applied.
  
  

\subsection{Torch Orientation in WAAM}
The torch orientation parameter in Wire Arc Additive Manufacturing (WAAM), similar to the cable routing orientation parameter, analyzes the angle at which the welding torch is positioned during the process. This parameter is specific to WAAM and ensures that the torch is at the optimal angle for welding. Achieving material deposition in the direction of gravity is crucial for obtaining the best results. The orientation of the Tool Center Point (TCP), which represents the welding torch tip, can be determined either through the forward kinematics approach or by extracting it directly from the G-code.

In both the forward kinematics approach and the G-code, the rotation is described as the rotation around the A, B, and C axes. However, the necessary information for torch orientation is simply the angle between the tilted Z-axis of the tool and the vector of gravity. To obtain this information, a dot product is performed between the rotation matrix and the Z-axis of the base coordinate system. This yields a vector corresponding to the tilted Z-axis of the tool. The enclosed angle can then be calculated using the scalar product. This step assumes that the defined coordinate system is oriented in a way that aligns the Z-axis parallel to the gravity vector.

Figure \ref{tilt} gives a visual example in 2D on how the Z-axis of the tool is deviating from the vector of gravity.

\begin{figure}[H]
	\centerline{\includegraphics[width=.5\textwidth]{figures/ttilt.png}}
	\caption{Example of non-optimal tilt in the welding torch}
	\label{tilt}
\end{figure}

To quantify the torch orientation parameter, it is recorded in a time series format. To obtain a scalar value for this parameter, all the values can be squared, cubed, or subjected to other mathematical operations, and then summed up. This process is similar to the one described in Chapter \ref{RO} for the cable routing orientation parameter.



\section{Summery for Boundary Condition Evaluation}
\section{General Methodology for Process Optimization}
\subsection{Without NX}
\subsection{With NX}